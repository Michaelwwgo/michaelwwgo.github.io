---
layout: post
title: 5G SS/PBCH Block 设计
categories: 5G_NR
description: 终端初始搜索，就是通过搜索 NR 同步栅格上的SS/PBCH Block 来确定小区。那么，本文将介绍 SS/PBCH Block 具体的时频位置如和确定，以及小区完成搜索过程如何完成初始接入等具体流程。
keywords: SSB, PointA, BWP
---

## Reference Subcarrier Spacing for FR1 and FR2

NR 针对 FR1 与 FR2 分别定义了参考坐标。这套坐标称为参考 RB。参考 RB 使用的 SCS 为 15kHz（FR1）或 60kHZ（FR2），如下图所示。参考 RB 对应 Synchronization Raster，用来描述 SS/PBCH-block 的频率位置。

![NR_ResourceBlockIndexing](/images/5G_NR/NR_ResourceBlockIndexing.png)

## BWP（Bandwidth Part）与 CRB（Common RB）

NR 系统带宽相比 LTE 要大得多，最大载波带宽高达 400GHz。而终端显然不可能也没必要支持如此大的带宽。因此，NR 定义了 BWP。BWP 的核心在于定义了一个小于系统工作带宽和不大于终端支持带宽的工作带宽，终端所有的操作都在 BWP 中完成。既实现了终端的省电目的，又可以满足系统调度资源的灵活度。

为了配置 BWP，NR 定义了 CRB。BWP 的时频位置可以通过 RRC 信令配置给终端，而配置 BWP 需要基于一个公共的参考坐标，而 CRB 就是这个频域标尺。CRB 对应 Channel Raster，用来对信道带宽进行索引。CRB 具体使用的 SCS 由 MIB 消息中的 *subCarrierSpacingCommon* 字段给出，该字段取值为 15/30kHz（FR1）或 60/120kHz（FR2）。*subCarrierSpacingCommon* 字段也指出了终端在初始接入时 SIB1，Msg2/4 所使用的 SCS 以及 Paging 和广播系统消息的 SCS。

CRB 配置好以后，信道带宽就可以依据给定 SCS 的 CRB 进行索引。如下图所示：

![CRB_CHBW](/images/5G_NR/CRB_CHBW.png)

在这里可以看出，信道带宽是由两个坐标系进行索引的，一个是以 CRB 为参考进行索引，对应 Channel Raster；一个是以参考 RB 进行索引，对应 Synchronization Raster。

## Point A

Point A 是 5G 中新增的概念，Point A 相当于一个频域上的参考点。因为在 5G 中，频带宽度大幅增加，频域资源分配的灵活度增加，在 5G 中弱化了中心频点的概念，而使用 Point A 作为频域上的参考点来进行其他资源的分配。Point A 指的是 CRB0 或 参考 PRB0 的 SC0 的中心频点，可以理解为参考坐标的原点。因此，不同 SCS 的 CRB 或参考 PRB 的 SC 是对齐的，但是起始边界并不对齐，如下图所示：

![CRB_SCS](/images/5G_NR/CRB_SCS_PointA.png)

## Offset

NR 中指示资源位置的方法大都是采用起始位置加资源大小，而起始位置需要同过与参考点 Point A 来确定。Offset 指的是所要找的频点位置距离参考点，即 Point A 的距离，单位可能是 RB 或 SC。

### *offsetToPointA*

offsetToPointA 字段定义在 SIB1 消息中，用于描述 SS/PBCH-block 到 Point A 之间的频率偏差，单位是 RB。使用参考 RB 坐标，即在 FR1 使用 15kHz SCS，在 FR2 使用 60kHz SCS。

### *offsetToCarrier*

虽然利用 CRB 完成了信道带宽的索引，但是真正投入使用的载波，即 CBW（Carrier Bandwidth），并不一定是从 CRB0 开始的。为了描述真正载波起始 RB $N^{start,\mu}_{grid}$ 的 SC0 的中心频点到 Point A 的距离，NR 在 SIB1 消息中定义了 offsetToCarrier 字段。该字段单位是 RB。使用的 SCS 通过 subcarrierSpacing 字段确定。该字段在 FR1 使用 15/30kHz SCS，在 FR2 使用 60/120kHz SCS。

### *kssb*

SS/PBCH-block 的位置是基于 Synchronization Raster 定义的，而 CRB 是基于 Channel Raster 定义的，这两者之间可能存在子载波偏移；此外，SS/PBCH-block 所使用的 SCS 通过 RRC 信令 *ssbSubcarrierSpacing* 字段或者通过盲检来确定，即15/30kHz（FR1）或 120/240kHz（FR2）。而 CRB 的 SCS 则由字段 *subCarrierSpacingCommon* 给出，这两者 SCS 之间的多种组合造成了 SS/PBCH-block 与 CRB 之间的子载波偏移。

为了描述子载波偏移，NR 在 MIB 消息中定义了 *ssb-SubcarrierOffset* 字段，即参数 kssb 来描述子载波偏移。在 FR1，kssb 的取值范围为 0-23，使用的 SCS 为 15kHz；在 FR2，kssb 的取值范围为 0-11，使用的 SCS 由字段 *subCarrierSpacingCommon* 确定。

除了指示子载波偏移，kssb 还指示了该 SS/PBCH-block 是否为 Cell-defining SS/PBCH-block，即该 SS/PBCH-block 是否关联了 SIB1 消息。只有通过 Cell-defining SS/PBCH-block，终端才能接入小区。若 kssb 的取值大于 23（FR1）或 11（FR2），该 SS/PBCH-block 为 Non Cell-defining SS/PBCH-block，即没有关联 SIB1 消息。此时，kssb 可以和 MIB 消息中的 *pdcch-ConfigSIB1* 字段联合指示最近的 Cell-defining SS/PBCH-block 的位置。

## 流程

到此为止，整个确定 SS/PBCH-block 以及 CRB 的过程如下：

1. 首先，终端通过盲检获取定义在 Synchronization Raster 上的 SS/PBCH-block，并通过 NR 预定义的[表格](https://sharetechnote.com/html/5G/5G_FR_Bandwidth.html#38_104_Table_5_4_3_3_1)来获取相应频段范围内 SS/PBCH-block 所使用的 SCS，[15/30kHz（FR1）或 120/240kHz（FR2）]。

2. 根据 *offsetToPointA* 字段确定 Point A 的位置，从而确定 RB $N^{SSB}_{CRB}$ 的位置。RB $N^{SSB}_{CRB}$ 的子载波 0 的中心频点与一个**与 SS/PBCH-block 的 lowest RB 相重叠的 CRB 的子载波 0 的中心频点位置相同**，对应的 SCS 由字段 *subCarrierSpacingCommon* 给出。

3. 通过 kssb 字段确定 SS/PBCH-block 的 lowest RB 子载波 0 与 RB $N^{SSB}_{CRB}$ 的子载波 0 的子载波偏移量。

通过上述步骤，终端可以为整个信道频域确立一个完整的 CRB 参考标尺。整个流程可以用下图[^1]来指示：
![NR_k_ssb](/images/5G_NR/NR_k_ssb.png)

其中，

- *subCarrierSpacingCommon* = 30kHz；
- kssb = 2；
- SS/PBCH-block 的 lowest RB 子载波 0 的中心位置与 RB $N^{SSB}_{CRB}$ 的子载波 1 的中心频点重合。

图中，紫色 RB 可能是作者笔误，应该指的是本文所讲的参考 PRB。RB $N^{SSB}_{CRB}$ 的边缘也有误，应该是指的 Start of CRB N。

## BWP 频域位置的确定

BWP 的频域位置是以 CRB 为索引，依据字段 *offsetToCarrier* 确定的，具体如下图所示：

![CRB_BWP](/images/5G_NR/CRB_BWP.png)

值得注意的是，PRB 是从 BWP 内部开始定义的，编号从 0 开始。

## 整体流程

如上所述，终端确定无线资源的整体流程如下图[^2]所示：

![Whole_process](/images/5G_NR/Whole_process.png)

## SS/PBCH-block 时域分布

相比 LTE，NR 工作频率大大提高，虽然传输速率随之变高，但是高频传输不可避免地造成了传输距离地受限。为了解决传输距离受限的问题，NR 利用波束赋形技术，将能量集中从而可以提高传输距离；但是波束赋形传输角度变小，从而无法实现无缝覆盖，为了解决该问题，NR 在不同时间发送不同朝向的波束，对覆盖范围进行波束扫描以实现小区的全覆盖。

基于以上设计理念，SS/PBCH-block 通过波束赋形并在时域上以波束扫描的方式进行发送。针对不同频段、不同子载波间隔，NR 定义了不同的 SS/PBCH-block 时域上的分布样式如下表所示：

| SCS | SSB 起始符号位置 | f<= 3GHz | 3< f< 6GHz| f > 6GHz|
| --- | --- | --- | --- | --- |
| Case A：15kHz | {2,8}+14*n | n=0,1 | n=0,1,2,3 | N/A |
| Case B：30kHz | {4,8,16,20}+28*n | n=0 | n=0,1 | N/A |
| Case C：30kHz | {2,8}+14*n | n=0,1 | n=0,1,2,3 | N/A |
| Case D：120kHz | {4,8,16,20}+28*n | N/A | N/A  | n=0,1,2,3,5,6,7,8,10,11,12,13,15,16,17,18 |
| Case E：240kHz | {8,12,16,20,32,36,40,44}+56*n | N/A | N/A  | n=0,1,2,3,5,6,7,8 |

在同一组波束中发射的 SSB 称为一个 SSB burst set 并具有下述特征：

- SSB burst set 中所有 SSB 位于同一个 half-frame 内(5ms)；
- SSB burst set 中所有 SSB 都在同一个天线端口传输；
- SSB burst set 中不同 SSB 具有不同 SSB index;
- 在 sub 6GHz，网络可以在一个维度，垂直或水平维度进行波束扫描。而在 6GHz 以上，网络可以在垂直和水平两个维度上进行波束扫描；
- SSB burst set 中最大的 SSB 个数 Lmax 由频率决定，

| 频率 | Lmax |
| --- | --- |
| f< 3GHz | 4 |
| ３<= f < 6GHz | 8 |
| f >= 6GHz | 64 |

最后就是 SSB 的周期，NR 支持 SSB 的周期为：5ms,10ms,20ms,40ms,80ms,160ms。在用户初始接入时，缺省的 SSB 周期为 20ms；在接入小区后，网络可以通过高层信令配置特定的 SSB 周期。

下图[^3]展示了，网络进行 SSB 扫描，终端进行 SBB 接收的过程。

![NR_SSB_BeamSweeping](/images/5G_NR/NR_SSB_BeamSweeping.png)

## SS/PBCH-block 的构成及 payload

SS/PBCH-block 的构成如下图所示：

![NR_FramsStructure_SS_PBCH](/images/5G_NR/NR_FramsStructure_SS_PBCH.png)

[^1]: <https://sharetechnote.com/html/5G/image/NR_k_ssb_01.png>.

[^2]: [5G 技术核心与增强----从 R15 到 R16].

[^3]: <https://sharetechnote.com/html/5G/image/NR_SSB_BeamSweeping_01.png>.

